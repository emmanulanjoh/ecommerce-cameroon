version: 1.0
runtime: nodejs18
build:
  commands:
    build:
      - npm install
      - npm run build || echo "TypeScript build failed, continuing..."
      - cd client && npm install
      - cd client && set GENERATE_SOURCEMAP=false && npm run build
run:
  runtime-version: 18.20.8
  command: node dist/server.js || node src/server.ts
  network:
    port: 5000
    env: PORT
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "5000"
    # SECURITY: Move all sensitive values to App Runner environment variables
    # Configure these in AWS App Runner console under Environment Variables
    - name: TRUST_PROXY
      value: "true"
    - name: EMAIL_HOST
      value: "smtp.gmail.com"
    - name: EMAIL_PORT
      value: "587"
    - name: BUSINESS_NAME
      value: "Findall sourcing"
    - name: BUSINESS_ADDRESS
      value: "Mimboman petit marche, Yaound√©, Cameroon"
    - name: GOOGLE_CLIENT_ID
      value: "303871422282-an28g8uthos88jir2blpdd9gti62msn8.apps.googleusercontent.com"
    - name: GOOGLE_CLIENT_SECRET
      value: "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"
    - name: GOOGLE_REDIRECT_URI
      value: "https://hpqe2tck8u.us-east-1.awsapprunner.com/api/auth/google/callback"
    - name: CLIENT_URL
      value: "https://hpqe2tck8u.us-east-1.awsapprunner.com"
    - name: APP_URL
      value: "https://hpqe2tck8u.us-east-1.awsapprunner.com"
    - name: MAX_FILE_SIZE
      value: "5242880"
    - name: UPLOAD_PATH
      value: "./dist/public/uploads"
    - name: DEFAULT_LANGUAGE
      value: "en"
    - name: SUPPORTED_LANGUAGES
      value: "en,fr"
    - name: AWS_ACCESS_KEY_ID
      value: "AKIATHFDHDE42ZT526PG"
    - name: AWS_SECRET_ACCESS_KEY
      value: "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"
    - name: AWS_REGION
      value: "us-east-1"
    - name: S3_BUCKET_NAME
      value: "ecommerce-cameroon-assets"
    - name: MONGODB_URI
      value: "mongodb+srv://emma:Emma2018@cluster0.jff9i.mongodb.net/ecommerce_cameroon_prod"
    - name: JWT_SECRET
      value: "klnjgdskj59e4kln94ejbwklbrbjkboi4h43hb34boh34909u6ikrnlsdnelnhgoh54b5nioerlkngoipjgpj95j34kjpe45je45jr65j9yokn5rin6lrnknr6"
    - name: SESSION_SECRET
      value: "gytfrdesawq34dcf6gty879tf@34iKojij"
    - name: BUSINESS_PHONE
      value: "+237678830036"
    - name: BUSINESS_EMAIL
      value: "emmanuelanjoh2016@gmail.com"
    - name: BUSINESS_WHATSAPP_NUMBER
      value: "+237678830036"